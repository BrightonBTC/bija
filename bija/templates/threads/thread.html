{%- extends "base.html" -%}
{%- block css -%}
{%- include 'css.html' -%}
{%- endblock css -%}

{%- block header -%}
<h1 class="main-title">
    {%- if root is not none -%}
        {%- if root is string -%}
            <span class="thread-head-im">
                {{'profile'| svg_icon('icon fill')|safe}}
            </span>
            <span class="thread-title">
                Thread: {{ root }}
            </span>
        {%- else -%}
            {%- with p=root -%}
            <span class="thread-head-im">
                {%- include 'profile/profile.image.html' -%}
            </span>
            {%- endwith -%}
            <span class="thread-title">
                Thread: {{ root['content']|strip_tags|truncate(50, False, '...', 0) }}
            </span>
        {%- endif -%}
    {%- endif -%}
</h1>
{%- endblock header -%}

{%- block content -%}
<div id="thread-items">
{%- if root is not none -%}
    {%- if root is string -%}
        {%- with id=root -%}
        {%- include 'threads/thread.placeholder.html' -%}
        {%- endwith -%}
    {%- else -%}
        {%- with item=root -%}
        {%- include 'threads/thread.item.html' -%}
        {%- endwith -%}
    {%- endif -%}
{%- endif -%}

{%- if parent is not none -%}
    {%- if parent is string -%}
        {%- with id=parent -%}
        {%- include 'threads/thread.placeholder.html' -%}
        {%- endwith -%}
    {%- else -%}
        {%- if parent['response_to'] is not none -%}
        <div class="note-container connector">
            <div class="thread-marker"></div>
            <div class="note-image"></div>
            <a href="#" data-rel="{{parent['response_to']}}" class="load_more">{{'up'| svg_icon('icon-sm')|safe}} Load more</a>
        </div>
        {%- endif -%}
        {%- with item=parent -%}
        {%- include 'threads/thread.item.html' -%}
        {%- endwith -%}
    {%- endif -%}
{%- endif -%}

{%- if note is not none -%}
    {%- if note is string -%}
        {%- with id=note -%}
        {%- include 'threads/thread.placeholder.html' -%}
        {%- endwith -%}
    {%- else -%}
        {%- with item=note -%}
        {%- include 'threads/thread.item.html' -%}
        {%- endwith -%}
    {%- endif -%}
{%- endif -%}

{%- for item in replies: -%}
    {%- if item is string -%}
        {%- with id=item -%}
        {%- include 'threads/thread.placeholder.html' -%}
        {%- endwith -%}
    {%- else -%}
        {%- include 'threads/thread.item.html' -%}
    {%- endif -%}

{%- endfor -%}
</div>



{%- endblock content -%}


{%- block right_content -%}
<h3 class="pad-tiny">in this thread</h3>
<div>
    <ul class="thread-members">
    {%- for p in members: -%}
        <li class="pad-mid">
        {%- include 'profile/profile.image.html' -%}
        <a href="{{ url_for('profile_page', pk=p['public_key']) }}" class="profile-name">{{p['name'] | ident_string(p['display_name'], p['public_key']) | safe }}</a>
        </li>
    {%- endfor -%}
    </ul>
</div>

{%- endblock right_content -%}